Registry.require(["helper","convert"],function(){var q=Registry.get("helper"),r=Registry.get("convert"),m={},u=function(b){var d=q.isLocalImage(b);return b&&4<b.length&&"http"==b.substr(0,4)||d},v={"user-agent":!0,referer:!0,origin:!0,host:!0,"proxy-connection":!0,"accept-encoding":!0,"accept-charset":!0},p=function(b,d,g){void 0===d&&(d={});void 0===g&&(g={});if(void 0!=window.chrome&&void 0!=window.chrome.xmlHttpRequest)window.chrome.xmlHttpRequest(b,d,g);else{var n=function(a,b){if(d[a])d[a]("function"==
typeof b?b():b)},e=function(a,b){d[a]&&(n(a,b),d[a]=null)},k=!(d.onload||d.onreadychange||d.onprogress||d.onerror||d.ondone||d.ontimeout),c=new XMLHttpRequest,h=function(){var a="",d=b.url;if(2<c.readyState&&(a=c.getAllResponseHeaders(),4==c.readyState)){a&&(a=a.replace(/TM-finalURL\: .*[\r\n]{1,2}/,""));var s=c.getResponseHeader("TM-finalURL");s&&(d=s)}a={readyState:c.readyState,responseHeaders:a,finalUrl:d,status:4==c.readyState?c.status:0,statusText:4==c.readyState?c.statusText:""};4==c.readyState?
(c.responseType?(a.responseXML=null,a.responseText=null,a.responseType=c.responseType):(a.responseXML=c.responseXML?escape(c.responseXML):null,a.responseText=c.responseText),a.response=c.response):(a.responseXML=null,a.responseText="",a.response=null);return a},l=function(a){a=h();4==a.readyState&&200!=a.status&&0!=a.status&&0<b.retries?(b.retries--,p(b,d,g)):function(){if(b.convertBinary&&a.response){var c=a.responseType?a.responseType.toLowerCase():"";if("blob"==c){var d,e=new FileReader;e.onload=
function(b){a.response2=r.arrbuf2str(e.result);a.response=null;d()};e.readAsArrayBuffer(a.response);return{done:function(a){d=a}}}"arraybuffer"==c?(a.response2=r.arrbuf2str(a.response),a.response=null):"json"==c&&(a.response2=JSON.stringify(a.response),a.response=null)}return{done:function(a){a()}}}().done(function(){e("onload",a);4==a.readyState&&e("ondone",a)})},w=function(){var a=h();4==a.readyState&&200!=a.status&&0!=a.status&&0<b.retries?(b.retries--,p(b,d,g)):(e("onerror",a),e("ondone",a))},
t=function(a,b,d){void 0===d&&(d={});try{var e=null,f=null;if(a.lengthComputable||0<a.totalSize)e=a.position||a.loaded,f=a.totalSize||a.total;else{var g=Number(q.getStringBetweenTags(b.responseHeaders.toLowerCase(),"content-length:","\n").trim()),h=c.responseText?c.responseText.length:0;0==g&&(g=-1);e=a.position||a.loaded||h;f=a.totalSize||a.total||g}d.lengthComputable=a.lengthComputable;d.loaded=e;d.done=e;d.total=f;d.totalSize=f}catch(k){}return d},x=function(a){n("onreadychange",function(){var b=
h();b.progress=t(a,b);return b})},y=function(a){n("onprogress",function(){var b=h();return t(a,b,b)})},z=function(a){a=h();e("ontimeout");e("ondone",a)};k||(c.onload=l,c.onerror=w,c.ontimeout=z,c.onprogress=y,c.onreadystatechange=x);try{if(!g.internal&&!u(b.url))throw Error("Invalid scheme of url: "+b.url);c.open(b.method,b.url,!k,b.user,b.password);if(b.headers)for(var f in b.headers)l=f,m.use&&v[f.toLowerCase()]&&(l=m.prefix+f),c.setRequestHeader(l,b.headers[f]);"undefined"!==typeof b.overrideMimeType&&
c.overrideMimeType(b.overrideMimeType);"undefined"!==typeof b.responseType&&(c.responseType=b.responseType);"undefined"!==typeof b.timeout&&(c.timeout=b.timeout);"undefined"!==typeof b.data?c.send(b.data):c.send()}catch(A){if(console.error(A.stack),f={responseXML:"",responseText:"",response:null,readyState:4,responseHeaders:"",status:403,statusText:"Forbidden"},e("onerror",f),e("ondone",f),k)return f}if(k)return h()}};Registry.register("xmlhttprequest","0",{run:p,setWebRequest:function(b){m=
b}})});
