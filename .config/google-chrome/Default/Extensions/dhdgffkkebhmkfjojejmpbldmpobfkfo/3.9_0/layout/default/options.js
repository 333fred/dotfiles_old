window.requestFileSystem||(window.requestFileSystem=window.webkitRequestFileSystem);
Registry.require("layout xmlhttprequest crcrc curtain cache layout/default/tabview layout/default/htmlutil helper statistics i18n syncinfo uri layout/default/layout_helper porter".split(" "),function(){var Ea=Registry.prepare(),q=Registry.get("crcrc").cr,h=Registry.get("crcrc").crc,ea=Registry.get("layout/default/tabview"),n=Registry.get("layout/default/htmlutil"),wa=Registry.get("statistics"),fa=Registry.get("syncinfo"),ga=Registry.get("cache"),v=Registry.get("curtain"),e=Registry.get("i18n"),s=
Registry.get("helper"),ha=Registry.get("uri"),M=Registry.get("porter"),ia=Registry.get("layout"),ja=Registry.get("layout/default/layout_helper"),N=ja.images,O=$.Deferred,Fa=function(){var e=O();e.resolve();return e.promise()};ia.render(function(){ja.addStyle();ja.addFont();var W={},w={},A=[],ka="0.0.0",Q={},xa={},J={},R=!0,u={},H=function(a,b){if(u[a]&&u[a][b])return u[a][b].apply(this,Array.prototype.slice.call(arguments,2));console.log("option: WARN: unable to find callback '"+b+"' for id '"+a+
"'")},L,ya=function(){L=s.getUrlArgs(!0)};window.onhashchange=ya;ya();L.open&&(L.selected="dashboard");(function(){A.push(function(){w.statistics_enabled&&(wa.init(Ea.SELF.ID),window.onerror=function(a,b,c,d,f){wa.tE(a,ka+" opt@"+b,[c+":"+d,f?f.stack:""].join(";"))})})})();var la=s.getDebouncer(1E3),ma=function(){for(;A.length;){var a=A[0];A=A.slice(1);a()}},ia=function(a){var b=q("input",a.name,a.id,"Save");b.inserted||(b.type="button",b.section=a,b.value=e.getMessage("Save"),b.addEventListener("click",
function(){var a=Array.prototype.slice.call(this.section.getElementsByTagName("textarea")),b=function(b){b.each(function(b,d){a.push(d)})};b($("#"+this.section.id).find("input"));b($("#"+this.section.id).find("select"));for(b=0;b<a.length;b++){var f=null,g=a[b],k=g.key;if("textarea"==g.tagName.toLowerCase())if(g.array)for(var g=g.value.split("\n"),f=[],l=0;l<g.length;l++)g[l]&&""!=g[l].trim()&&f.push(g[l]);else f=g.value;else"checkbox"==g.getAttribute("type")?f=g.checked:"select"==g.getAttribute("type")?
(f=0,0<=g.selectedIndex&&g.selectedIndex<g.options.length&&(f=g.selectedIndex),f=g[f]?g[f].value:g.options[0].value):"button"!=g.getAttribute("type")&&(f=g.value);k&&na(k,f)}},!1));return b},Ha=function(a){var b=function(a,b,d,c,g){var f=h("th","settingsth",a.name,a.id,b),l=h("a","settingsth_a",a.name,a.id,b+"_a");l.setAttribute("name","settingsth_a"+a.name);var m=h("a","settingsth_a_up",a.name,a.id,b+"_a_up");m.setAttribute("name","settingsth_a_up"+a.name);var k=h("a","settingsth_a_down",a.name,
a.id,b+"_a_down");k.setAttribute("name","settingsth_a_down"+a.name);var e=function(){for(var b=document.getElementsByName("settingsth_a_up"+a.name),d=document.getElementsByName("settingsth_a_down"+a.name),c=0;c<b.length;c++)b[c].style.display="none";for(c=0;c<d.length;c++)d[c].style.display="none";"up"==S()?m.style.display="":k.style.display=""},r=function(){e()};b=function(){window.setTimeout(function(){if(P()==c){var a="down"==S()?"up":"down";localStorage.setItem("sort_sequence",a)}else localStorage.setItem("sort_key",
c);za(r)},1)};f.inserted||(f.appendChild(l),f.appendChild(k),f.appendChild(m),l.addEventListener("click",b),m.addEventListener("click",b),k.addEventListener("click",b),l.textContent=d+" ",l.href="#",m.innerHTML="&#x25B4;",m.href="#",k.innerHTML="&#x25BE;",k.href="#");g&&!P()?(localStorage.setItem("sort_key",c),localStorage.setItem("sort_sequence","up"),window.setTimeout(e,1)):c==P()&&window.setTimeout(e,1);return f},c,d,f,g,k;g=q("tbody",a.name,a.id,"body");k=q("thead",a.name,a.id,"head");if(a.scriptTab){var l=
Ga(a);c=h("table","scripttable",a.name,a.id,"main");var m=h("th","script_sel",a.name,a.id,"thead_sel");m.appendChild(l.selAllm);f=h("tr","multiselect settingstr filler",a.name,a.id,"filler_multi");var r=h("th","",a.name,a.id,"thead_multi");r.setAttribute("colspan","9");r.appendChild(l.actionBox);$(f).hide();f.setAttribute("name","multiselectcol");f.appendChild(m);f.appendChild(r);m=h("th","script_sel",a.name,a.id,"thead_sel");m.appendChild(l.selAll);var l=b(a,"thead_en","#","pos"),r=b(a,"thead_name",
e.getMessage("Name"),"name",!0),p=b(a,"thead_ver",e.getMessage("Version"),"ver"),y=h("th","settingsth",a.name,a.id,"thead_type");y.textContent=e.getMessage("Type");var z=h("th","settingsth",a.name,a.id,"thead_sync");z.textContent="";var n=b(a,"thead_sites",e.getMessage("Sites"),"sites");n.width="25%";var Aa=h("th","settingsth",a.name,a.id,"thead_features");Aa.textContent=e.getMessage("Features");var I=b(a,"thead_homepage",e.getMessage("Homepage"),"homepage"),b=b(a,"thead_updated",e.getMessage("Last_Updated"),
"updated"),x=h("th","settingsth",a.name,a.id,"thead_sort"),t=h("span","sorting",a.name,a.id,"thead_sort_span");t.textContent=e.getMessage("Sort");"pos"==P()&&"up"==S()||t.setAttribute("style","display: none;");x.appendChild(t);t=h("th","settingsth",a.name,a.id,"thead_del");t.textContent=e.getMessage("Actions");A.push(function(){w.sync_enabled&&(z.textContent=e.getMessage("Imported"))});d=h("tr","settingstr filler",a.name,a.id,"filler");d.setAttribute("style","height: 36px;");d.setAttribute("name",
"multiselectcol_hide");s.each([m,l,r,p,y,z,n,Aa,I,b,x,t],function(a,b){d.appendChild(a)});k.appendChild(f);k.appendChild(d);k.setAttribute("name","multiselectrow");d.inserted||(u.multiselect.checkScroll=function(a){a=$(k).is(":visible")&&$(f).is(":visible")&&$(window).scrollTop()>$(k).offset().top;$(f).toggleClass("multi_scrolling",a)},$(window).scroll(u.multiselect.checkScroll))}else c=h("table","settingstable",a.name,a.id,"main"),d=h("tr","settingstr filler",a.name,a.id,"filler"),g.appendChild(d);
c.appendChild(k);c.appendChild(g);return{table:c,head:k,body:g}},Ba=function(a,b,c,d){var f=[],g=function(){[0,1].forEach(function(){f.unshift(null)})};if(b.divider)return null;b.image&&(b.imageURL=N.get(b.image));if(b.checkbox){g=function(){var a=!0;this.warning&&(a=Z(this.warning),a||(this.checked=!this.checked));a&&(na(this.key,this.checked,this.reload),this.reload&&window.location.reload())};c&&c.need_save&&(g=l=null);var k=n.createCheckbox(b.name,b,g);f.push(k.elem)}else if(b.button)k=n.createButton(b.name,
b,function(){var a=!0;this.warning&&(a=Z(this.warning));a&&Ia(this.key,!0,this.ignore,this.reload)}),f.push(k);else if(b.input)k=n.createTextarea(b.name,b),f.push({element:k.elem,validation:k.label}),c&&(c.need_save=!0);else if(b.text)k=n.createInput(b.name,b),f.push(k.elem),c&&(c.need_save=!0);else if(b.password)k=n.createPassword(b.name,b),f.push(k.elem),c&&(c.need_save=!0);else if(b.select){var l=function(){var a=!0;this.warning&&(a=Z(this.warning),a||(this.value=this.oldvalue));a&&(na(this.key,
this.value,this.reload),this.reload&&window.location.reload())};c&&c.need_save&&(l=b.enabler?function(){var a=document.getElementsByName("enabled_by_"+this.key),b=(this.selectedIndex<this.options.length?this.options[this.selectedIndex]:this.options[0]).getAttribute("enables"),d=b?JSON.parse(b):{};s.each(a,function(a){void 0===d[a.key]||d[a.key]?a.setAttribute("style",s.staticVars.visible):a.setAttribute("style",s.staticVars.invisible)})}:null);k=n.createDropDown(b.name,b,b.select,l,function(){var a=
!0;this.selectedOptions.length&&this.selectedOptions[0].warning&&this.selectedOptions[0].value!==this.oldvalue&&(a=Z(this.selectedOptions[0].warning),a||(this.value=this.previousValue||this.oldvalue));this.previousValue=this.value});f.push(k.elem);a&&b.enabler&&function(){var a=l,b=k;A.push(function(){a.apply(b.select,[])})}()}else if(b.url){var m=q("a",b.name,b.id);m.href="#";m.url=b.url;m.newtab=b.newtab;m.inserted||(l=function(){pa(this.url,this.newtab)},m.addEventListener("click",l));m.textContent=
b.name;f.push(m);g()}else if(b.main_menu_item){g=q("span",b.name,b.id);g.textContent=b.name;var m=Ha(b),e=q("div",b.name,b.id,"tab_content");e.appendChild(m.table);var p=null,g=d.appendTab(b.id,g,e,function(){p&&(W.global?p():A.push(p))});b.referrer&&(p=function(){p=null;v.wait();aa({referrer:b.referrer},function(b){b.items.forEach(function(b){Ba(a,b,c,d)});ma();v.hide()})});b.items&&ba(m.body,b.items,null,d);W.global||!b.selected_default||L.selected||g.select()}else if(b.sub_menu_item)m=h("div",
"section",b.name,b.id),g=h("div","section_head",b.name,b.id,"head"),e=h("table","section_content",b.name,b.id,"content"),g.textContent=b.name,m.appendChild(g),b.desc&&n.setHelp(b.desc,g,g,b),m.appendChild(e),ba(e,b.items,b,d),b.need_save&&e.appendChild(ia(e)),f.push(m);else if(b.userscript||b.nativeScript||b.user_agent){f=Ja(b,a,d);if(b.userscript||b.user_agent)J[b.uuid]={dom:a,script:b};a.setAttribute("class","scripttr");b.nnew?a.setAttribute("style","display: none;"):la.is("script_refresh")||(A.push(function(){qa.init(s.map(J,
function(a){return a.script}));u.multiselect.single_click();za();W.scripts=!0;la.clear()}),la.add("script_refresh"))}else b.version?(ka=b.value,h("div","version","version","version").textContent="v"+ka+" by Jan Biniok"):b.globalhint?(g=h("span","global_hint","globalhint","globalhint"),m=q("span","globalhintt","globalhintt"),e=q("span","globalhintt","globalhintt"),e.textContent=b.value,b.description&&(e.title=b.description),e.url=b.info_url,b.image&&m.appendChild(n.createImage(b.imageURL,"globalhint",
"icon")),b.info_url&&!e.inserted&&(l=function(){pa(this.url,!0)},e.addEventListener("click",l)),m.appendChild(e),g.appendChild(m),document.body.appendChild(g)):(m=q("span","",b.uuid||b.id+b.name),m.textContent=b.name,f.push(m),g());f.forEach(function(a){if(a){void 0!==b.level&&(a.element||a).setAttribute("style",b.level>w.configMode?s.staticVars.invisible:s.staticVars.visible||"");if(b.hint){var d=q("span","",b.uuid||b.id+b.name,"hint");d.textContent=b.hint;a.appendChild(d)}b.validation&&Ka(b,a.validation||
a.element||a);b.width&&a.setAttribute("class","width-172-"+b.width)}});a&&(e=a.getAttribute("class"),g=" hide",!1===b.visible?e=(e||"")+g:e&&(e=e.replace(g,"")),a.setAttribute("class",e));return f},ba=function(a,b,c,d){for(var f in b){var g=b[f],e=a?q("tr","",g.uuid||g.id+g.name,"pi"):null,l=Ba(e,g,c,d);l&&l.length&&(a&&a.appendChild(e),s.each(l,function(a,b){var d=a,c="";"Object"===s.toType(a)&&(d=a.element,c=a.style);c=h("td",c,"",g.uuid||g.id+g.name,b);a&&c.appendChild(d);e&&e.appendChild(c)}))}},
Z=function(a){if(a.once){if(xa[a.msg])return!0;xa[a.msg]=!0}var b=confirm(a.msg),c={};b&&a.ok?c=a.ok:!b&&a.cancel&&(c=a.cancel);if(a.ok||a.cancel)b=!0;c.url&&sendMessage({method:"newTab",url:c.url},function(a){});return b},Ka=function(a,b){var c;a.validation&&(a.validation.url&&(c=function(){pa(this.url,!0)}),a.validation.image&&(a.validation.imageURL=N.get(a.validation.image)),c=n.createAfterIcon(a,c))&&(c.url=a.validation?a.validation.url:void 0,b.appendChild(c))},La=function(a){return{source:a.code,
meta:{name:a.name,uuid:a.uuid,modified:a.lastModified,file_url:a.file_url&&a.file_url.trim()?a.file_url:void 0},storage:a.storage,options:a.options,settings:{enabled:a.enabled,position:a.position}}},ca=function(a,b){var c=O(),d=[];Ma(a,b).done(function(a){a.scripts.forEach(function(a){!a.uuid||!a.userscript&&!a.user_agent||a.system||a.nnew||(a.code&&""!=a.code.trim()?d.push(La(a)):console.log("options: Strange script: "+a.name))});c.resolve(d)}).fail(function(){c.reject()});return c.promise()},Na=
function(a){var b=q("div","utils","utils","tab_util_h");b.textContent=e.getMessage("Utilities");var c=q("div","utils","utils","tab_util");a.appendTab("util_tabutils",b,c).show();a=h("div","tv_util","utils","utils","tab_util_cont");var d=function(a){var b=O(),d=new FileReader;d.onload=function(a){b.resolve(a.target.result)};d.readAsText(a);return b.promise()},f=n.createButton("utils","utils_i_ta",e.getMessage("Import"),function(){M.json.read(p.value).then(function(a){return ra(a,{reload:!0})}).done(function(a){a.err&&
s.alert(a.err)}).fail(function(){s.alert(e.getMessage("Unable_to_parse_this_"))})}),g=n.createFileSelect(e.getMessage("Import"),{name:"zip",id:"utils"},function(a){v.wait();for(var b=0,d;d=a[b];b++)M.zip.read(d).progress(function(a){v.wait(Math.floor(a.item/a.of*100)+"%")}).then(function(a){return ra({scripts:s.map(a,function(a){var b=a.meta||{},d=a.settings||{};return{source:a.source,name:b.name,uuid:b.uuid,file_url:b.file_url,options:a.options,storage:a.storage,lastModified:b.modified,enabled:d.enabled,
position:d.position}})},{reload:!0})}).done(function(a){a.err&&s.alert(a.err)}).fail(function(){s.alert(e.getMessage("Unable_to_parse_this_"))}).always(v.hide)}),b=n.createFileSelect(e.getMessage("Import"),{name:"file",id:"utils"},function(a){for(var b=0,c;c=a[b];b++)d(c).then(function(a){return M.json.read(a)}).then(function(a){return ra(a,{reload:!0})}).done(function(a){a.err&&s.alert(a.err)}).fail(function(){s.alert(e.getMessage("Unable_to_parse_this_"))})}),k=n.createButton("utils","utils_e_ta",
e.getMessage("Export"),function(){ca(null,{storage:R}).then(function(a){return M.json.create(a)}).done(function(a){p.value=a})}),l=n.createButton("utils","utils_e_file",e.getMessage("Export"),function(){ca(null,{storage:R}).then(function(a){return M.json.download(a)})}),m=n.createButton("utils","utils_e_zip",e.getMessage("Export"),function(){ca(null,{storage:R}).then(function(a){v.wait();return M.zip.download(a).progress(function(a){v.wait(Math.floor(a.item/a.of*100)+"%")})}).always(function(){v.hide()})}),
r=n.createCheckbox(e.getMessage("Include_script_storage"),{id:"utils_e_data_zip",enabled:"true"},function(){R=this.checked});r.elem.setAttribute("style","padding-left: 15px; display: inline");r.input.checked=R;var p=h("textarea","importta","utils","utils","ta"),y=h("div","section","utils","utils","ta"),z=h("div","section_head","utils","utils","head_ta"),F=h("div","section_content","utils","utils","content_ta");z.textContent=e.getMessage("General");F.appendChild(r.elem);y.appendChild(z);y.appendChild(F);
r=h("div","section","utils","utils","ta");z=h("div","section_head","utils","utils","head_ta");F=h("div","section_content","utils","utils","content_ta");z.textContent=e.getMessage("TextArea");F.appendChild(k);F.appendChild(f);F.appendChild(p);r.appendChild(z);r.appendChild(F);f=h("div","section","utils","utils","sb");k=h("div","section_head","utils","utils","head_sb");z=h("div","section_content","utils","utils","content_sb");k.textContent=e.getMessage("Zip");f.appendChild(k);f.appendChild(z);z.appendChild(m);
z.appendChild(g.elem);g=h("div","section","utils","utils","fi");m=h("div","section_head","utils","utils","head_fi");k=h("div","section_content","utils","utils","content_fi");m.textContent=e.getMessage("File");g.appendChild(m);g.appendChild(k);k.appendChild(l);k.appendChild(b.elem);a.appendChild(y);a.appendChild(f);a.appendChild(g);a.appendChild(r);s.each([r],function(a){var b=a.getAttribute("class"),b=50>w.configMode?b+" hide":b.replace(" hide","");a.setAttribute("class",b)});c.appendChild(a)},Oa=
function(){var a=document.getElementById("options"),b=h("div","main_container p100100","options","main");if(a){var c=a.parentNode;c.removeChild(a);c.appendChild(b);document.body.setAttribute("class","main")}var a=h("div","head_container","opt","head_container"),c=h("div","tv_container","opt","tv_container"),d=q("a","head_link","fire","head_link");d.href="http://tampermonkey.net";d.target="_blank";var f=h("div","float margin4","fire","head1"),g=h("img","banner","fire");g.src=chrome.extension.getURL("images/icon128.png");
var e=h("div","float head margin4","fire","head2"),l=q("div","fire"),m=h("div","version","version","version");m.textContent=" by Jan Biniok";var r=q("div","search","box","");l.textContent="Tampermonkey";f.appendChild(g);e.appendChild(l);e.appendChild(m);d.appendChild(f);d.appendChild(e);a.appendChild(d);a.appendChild(r);b.appendChild(a);b.appendChild(c);var p=ea.create("_main",c);A.push(function(){Na(p);if(L.selected){var a=p.getTabById(L.selected);a&&a.select()}W.global=!0})},U=function(a,b,c){var d=
b.item,f=d.uuid+b.id,g=(c?"orig_":"use_")+b.id,k=function(a){return"select_"+s.createUniqueId(a,d.uuid)+"_sel1"},l=h("div","cludes",a,f,"cb1");if(document.getElementById(k(g)))return{elem:l};var m=q("span",d.name,f,"cb2");if(c){var r="merge_"+b.id;a=n.createCheckbox(a,{id:r,uuid:d.uuid,enabled:d.options&&d.options.override&&d.options.override[r]?!0:!1},function(){if("checkbox"==this.type){var a={};a[this.key]=!this.oldvalue;T(this.uuid,a)}});m.appendChild(a.elem)}else m.textContent=a;a=d.options&&
d.options.override&&d.options.override[g]?d.options.override[g]:[];var p=h("select","cludes",g,d.uuid,"sel1");p.setAttribute("size","6");p.setAttribute("multiple","true");for(g=0;g<a.length;g++)r=document.createElement("option"),r.value=r.text=a[g],p.appendChild(r);l.appendChild(m);d.desc&&n.setHelp(d.desc,l,m,d);l.appendChild(p);var y=function(a){var b=[];a=a&&a.options;for(var d=0,c=a.length;d<c;d++)a[d].selected&&b.push(a[d]);return b};a=function(){var a=k("use_"+("excludes"==b.id?"includes":"excludes")),
d=document.getElementById(a),a=y(p),c=!1,f="matches"==b.id;a.forEach(function(a){var b=f?"/"+ha.getRegExpFromMatch(a.value)+"/":a.value;a&&!d.querySelector('option[value="'+b+'"]')&&(a=a.cloneNode(!0),f&&(a.value=b,a.textContent=b),d.appendChild(a),c=!0)});c&&F()};var r=function(){var a=prompt(e.getMessage("Enter_the_new_rule"));if(a){var b=document.createElement("option");b.value=b.text=a.trim();p.appendChild(b);F()}},g=function(){var a=p.options[p.selectedIndex];if(a){var b=prompt(e.getMessage("Enter_the_new_rule"),
a.value);b&&(a.value=a.text=b.trim(),F())}},m=function(){var a=!1;y(p).forEach(function(b){b&&(b.parentNode.removeChild(b),a=!0)});a&&F()},z=function(a){for(var b=[],d=0;d<a.options.length;d++)b.push(a.options[d].value);return b},F=function(){var a={includes:z(document.getElementById(k("use_includes"))),matches:z(document.getElementById(k("use_matches"))),excludes:z(document.getElementById(k("use_excludes")))};T(d.uuid,a);return!0};c?(f=q("button",d.name,f,"btn1"),f.textContent=e.getMessage("Add_as_0clude0",
c),f.addEventListener("click",a,!1)):(c=q("button",d.name,f,"btn2"),c.textContent=e.getMessage("Add")+"...",c.addEventListener("click",r,!1),l.appendChild(c),c=q("button",d.name,f,"btn3"),c.textContent=e.getMessage("Edit")+"...",c.addEventListener("click",g,!1),l.appendChild(c),f=q("button",d.name,f,"btn4"),f.textContent=e.getMessage("Remove"),f.addEventListener("click",m,!1));l.appendChild(f);return{elem:l}},sa=function(a){return a.homepage?a.homepage:a.namespace&&0==a.namespace.search(/https?:\/\//)?
a.namespace:null};ga.create("sites").setOptions({timeout:600,check_interval:300,retimeout_on_get:!0}).init();var qa=function(){var a={},b=function(a){return 7>a.toString().length?b("0"+a):a},c=function(a){if(a.includes||a.matches){for(var b={},c=[],e=a.includes.length?a.includes:a.matches,l=0;l<e.length;l++){var m=e[l];if(m){var r=ga.items.sites.get(m),h=void 0!==r?r:n.getInfoFromUrl(m);void 0===r&&ga.items.sites.set(m,h);h&&h.dom?b[h.dom]||(b[h.dom]=!0,c.push({include:m,info:h})):c.push({include:m})}else console.log("o: Warn: script '"+
a.name+"' has invalid include (index: "+l+")")}return c}};return{init:function(b){a={};b.forEach(function(b){(b=c(b))&&b.length&&b.forEach(function(b){b.info&&(a[b.info.dom]=(a[b.info.dom]||0)+1)})})},get:function(d){d=c(d);if(!d||!d.length)return b(0);d=s.map(d,function(b){return b.info?{score:1E3*a[b.info.dom]+b.info.dom.charCodeAt(0)||0,dom:b.info.dom}:{score:0,dom:""}}).sort(function(a,b){return b.score-a.score})[0];return b(d.score)+d.dom},topIcons:function(b,f){var g=[],e=c(b);if(!e||!e.length)return[];
e=s.map(e,function(b){b.score=b.info?a[b.info.dom]||0:0;return b}).sort(function(a,b){return b.score-a.score});s.each(e,function(a){var c=a.info;if(0==f--)return a=h("span","",b.uuid,"tbc"),a.textContent="...",g.push(a),!1;if(c){if("*"==c.tld)return a=n.createImage(chrome.extension.getURL("/layout/default/images/web.png"),"",b.uuid,a.include,a.include),g.push(a),!1;var e="com",k="";"*"!=c.tld&&"tld"!=c.tld&&(e=c.tld);c.subdom.length&&(k=c.subdom.join(".")+".");var y=("chrome://favicon/http://"+k+
c.dom+"."+e+"/").replace(/\*/g,""),c=("http://"+k+c.dom+"."+e+"/favicon.ico").replace(/\*/g,""),y=[c,y];if(0==c.search("http://userscripts.org/")||0==c.search("http://userscripts.com/"))y=N.origin("uso");a=n.createFavicon(y,"",b.uuid,a.include,a.include)}else a=n.createFavicon("?","",b.uuid,a.include,a.include);g.push(a)});return g}}}(),P=function(){return localStorage.getItem("sort_key")},S=function(){return localStorage.getItem("sort_sequence")},za=function(a){var b=function(a,d){return a.tagName==
d?a:a.parentNode?b(a.parentNode,d):null},c=null,d=[],f=0,g=(new Date).getTime(),k;for(k in J){var l=J[k];if(l){var m=b(l.dom,"TR");if(m){var h=b(m,"TBODY");c?h&&c!=h&&console.warn("options: different parents?!?!"):c=h;f++;h=g-parseInt(l.script.lastUpdated);isNaN(h)&&(h=0);var p=parseInt(l.script.version);isNaN(p)&&(p=0);d.push({tr:m,sites:qa.get(l.script),position:l.script.position?l.script.position:1E3+f,name:e.getTranslation(l.script,"name").toLowerCase(),homepage:[l.script.origin?ha.parse(l.script.origin.url).hostname:
"z",sa(l.script)?ha.parse(sa(l.script)).hostname:"z"].join("_"),updated:h,version:p});m.inserted=!1;m.parentNode&&m.parentNode.removeChild(m)}else console.log("options: unable to sort script at pos "+l.pos)}else console.warn("options: something went wrong!",k)}d=function(a){var b;b=function(a){return function(b,d){return b[a]-d[a]}};var d=function(a){return function(b,d){return b[a]<d[a]?-1:b[a]>d[a]?1:0}},c=P();b="pos"==c?b("position"):"ver"==c?b("version"):"updated"==c?b("updated"):d(c);a.sort(b);
return a}(d);"down"==S()&&(d=d.reverse());for(g=0;g<f;g++)c.appendChild(d[g].tr);$(".sorting").each(function(a,b){var d=$(b),c="pos"==P()&&"up"==S();d[c?"fadeIn":"fadeOut"]()});a&&a()},Sa=function(a,b,c,d,f){var g=h("div","",b.name,b.uuid,"script_tab_head");c=g.inserted;var k=h("div","heading",b.uuid,"heading"),l=h("img","nameNicon64",b.uuid,"heading_icon"),m=b.icon64?b.icon64:b.icon;l.src=m;var r=h("div","nameNname64",b.uuid,"heading_name");r.textContent=e.getTranslation(b,"name");m&&k.appendChild(l);
k.appendChild(r);l=h("div","author",b.uuid,"author");b.author?l.textContent="by "+b.author:b.copyright&&(l.innerHTML="&copy; ",l.textContent+=b.copyright);var m=h("table","noborder p100100",b.uuid,"table"),r=h("tr","script_tab_head",b.uuid,"tr1"),p=h("tr","details",b.uuid,"tr2"),n=h("td","",b.uuid,"td1"),z=h("td","",b.uuid,"td2");k.appendChild(l);g.appendChild(k);n.appendChild(g);r.appendChild(n);p.appendChild(z);m.appendChild(r);m.appendChild(p);d.appendChild(m);d=ea.create("_details"+s.createUniqueId(b.name,
b.uuid),z,{tv:"tv tv_alt",tv_table:"tv_table tv_table_alt",tr_tabs:"tr_tabs tr_tabs_alt",tr_content:"tr_content tr_content_alt",td_content:"td_content td_content_alt",td_tabs:"td_tabs td_tabs_alt",tv_tabs_align:"tv_tabs_align tv_tabs_align_alt",tv_tabs_fill:"tv_tabs_fill tv_tabs_fill_alt",tv_tabs_table:"tv_tabs_table tv_tabs_table_alt",tv_contents:"tv_contents tv_contents_alt",tv_tab_selected:"tv_tab tv_selected tv_tab_alt tv_selected_alt",tv_tab_close:"",tv_tab:"tv_tab tv_tab_alt",tv_content:"tv_content tv_content_alt"});
var q=Pa(b,d,f),u=b.nnew||b.system?{}:Qa(b,d),I=b.nnew||b.system||!b.requires.length&&!b.resources.length?{}:Ra(b,d);if(c)return Q["tab"+b.uuid];var x=function(b){var d=!1;if("keydown"==b.type&&(27==b.keyCode&&"windows"==w.editor_keyMap&&(a.isSelected()&&window.setTimeout(f,1),d=!0),d))return b.stopPropagation(),b.preventDefault(),!1};d={onShow:function(){s.each([u,q,I],function(a){if(a.onShow)a.onShow()});window.addEventListener("keydown",x,!0)},onClose:function(a){var b;s.each([u,q,I],function(d){if(d.onClose&&
d.onClose(a))return b=!0,!1});b||window.removeEventListener("keydown",x,!0);return b},afterSelect:function(){s.each([u,q,I],function(a){a.afterSelect&&a.afterSelect()})}};return Q["tab"+b.uuid]=d},Qa=function(a,b){var c=q("div",a.name,a.uuid,"script_setting_h"),d=q("div",a.name,a.uuid,"script_settings_c");c.textContent=e.getMessage("Settings");var f=function(){if("checkbox"==this.type||"button"==this.type){var a={};a[this.key]=!this.oldvalue;T(this.uuid,a)}else if("text"==this.type||"textarea"==this.type||
"select-one"==this.type){var b=this.value;if("native"===this.valtype)if("undefined"===b)b=void 0;else if("null"===b)b=null;else try{b=JSON.parse(b)}catch(d){}a={};a[this.key]=b;T(this.uuid,a)}},g=n.createPosition(e.getMessage("Position_")+": ",{id:"position",uuid:a.uuid,name:a.name,pos:a.position,posof:a.positionof},f),k=n.createDropDown(e.getMessage("Run_at"),{id:"run_at",uuid:a.uuid,name:a.name,value:a.run_at},[{name:"document-start",value:"document-start"},{name:"document-body",value:"document-body"},
{name:"document-end",value:"document-end"},{name:e.getMessage("Default"),value:null}],f),l=n.createDropDown(e.getMessage("No_frames"),{id:"noframes",uuid:a.uuid,name:a.name,value:a.noframes},[{name:e.getMessage("Yes"),value:!0},{name:e.getMessage("No"),value:!1},{name:e.getMessage("Default"),value:null}],f),m=U(e.getMessage("Original_includes"),{id:"includes",item:a},e.getMessage("User_excludes")),r=U(e.getMessage("Original_matches"),{id:"matches",item:a},e.getMessage("User_excludes")),p=U(e.getMessage("Original_excludes"),
{id:"excludes",item:a},e.getMessage("User_includes")),y=h("div","clear",a.name,a.uuid,"clear"),z=U(e.getMessage("User_includes"),{id:"includes",item:a}),s=U(e.getMessage("User_matches"),{id:"matches",item:a}),u=U(e.getMessage("User_excludes"),{id:"excludes",item:a}),w=n.createCheckbox(e.getMessage("Apply_compatibility_options_to_required_script_too"),{id:"compatopts_for_requires",uuid:a.uuid,name:a.name,enabled:a.compatopts_for_requires},f),x=n.createCheckbox(e.getMessage("Fix_wrappedJSObject_property_access"),
{id:"compat_wrappedjsobject",uuid:a.uuid,name:a.name,enabled:a.compat_wrappedjsobject},f),t=n.createCheckbox(e.getMessage("Convert_CDATA_sections_into_a_chrome_compatible_format"),{id:"compat_metadata",uuid:a.uuid,name:a.name,enabled:a.compat_metadata},f),v=n.createCheckbox(e.getMessage("Replace_for_each_statements"),{id:"compat_foreach",uuid:a.uuid,name:a.name,enabled:a.compat_foreach},f),C=n.createCheckbox(e.getMessage("Fix_for_var_in_statements"),{id:"compat_forvarin",uuid:a.uuid,name:a.name,enabled:a.compat_forvarin},
f),D=n.createCheckbox(e.getMessage("Convert_Array_Assignements"),{id:"compat_arrayleft",uuid:a.uuid,name:a.name,enabled:a.compat_arrayleft},f),E=n.createCheckbox(e.getMessage("Add_toSource_function_to_Object_Prototype"),{id:"compat_prototypes",uuid:a.uuid,name:a.name,enabled:a.compat_prototypes},f),w=[w,x,t,v,C,D,E],x=h("div","section",a.name,a.uuid,"ta_opt"),v=h("div","section_head",a.name,a.uuid,"head_ta_opt"),t=h("div","section_content",a.name,a.uuid,"content_ta_opt");v.textContent=e.getMessage("Settings");
x.appendChild(v);x.appendChild(t);v=h("div","section",a.name,a.uuid,"ta_cludes");C=h("div","section_head",a.name,a.uuid,"head_ta_cludes");E=h("div","section_content",a.name,a.uuid,"content_ta_cludes");C.textContent=e.getMessage("Includes_Excludes");v.appendChild(C);v.appendChild(E);var C=h("div","section",a.name,a.uuid,"ta_compat"),A=h("div","section_head",a.name,a.uuid,"head_ta_compat"),D=h("div","section_content",a.name,a.uuid,"content_ta_compat");A.textContent=e.getMessage("GM_compat_options_");
C.appendChild(A);C.appendChild(D);t.appendChild(g);a.user_agent||t.appendChild(k.elem);t.appendChild(l.elem);E.appendChild(m.elem);E.appendChild(r.elem);E.appendChild(p.elem);E.appendChild(y);E.appendChild(z.elem);E.appendChild(s.elem);E.appendChild(u.elem);g=q("div",a.name,a.uuid,"tab_content_settings");g.appendChild(x);g.appendChild(v);if(!a.user_agent){for(k=0;k<w.length;k++)D.appendChild(w[k].elem);if(a.awareOfChrome)for(var X in w)w[X].input.setAttribute("disabled","disabled"),w[X].elem.setAttribute("title",
e.getMessage("This_script_runs_in_Chrome_mode"));g.appendChild(C)}var oa=n.createTextarea(null,{name:a.name,uuid:a.uuid,id:"comment",value:a.options.comment});oa.elem.setAttribute("class","script_setting_wrapper");X=q("div",a.name,a.uuid,"save");k=n.createButton(a.name,a.uuid,e.getMessage("Save"),function(){f.apply(oa.textarea,[])});X.appendChild(k);k=h("div","section",a.name,a.uuid,"ta_comment");l=h("div","section_head",a.name,a.uuid,"head_ta_comment");m=h("div","section_content",a.name,a.uuid,"content_ta_comment");
l.textContent=e.getMessage("Comment");k.appendChild(l);k.appendChild(m);m.appendChild(oa.elem);m.appendChild(X);g.appendChild(k);d.appendChild(g);b.appendTab("script_settings_tab"+a.uuid,c,d);return{}},Ca=function(a,b){var c=h("table","script_desc",a.name,a.uuid,"outer_req2html"),d=0,f=[{label:e.getMessage("URL"),prop:"url"},{label:e.getMessage("Size"),prop:"data",fn:function(a){return a&&a.content?a.content.length+" Bytes":"?"}},{label:e.getMessage("Last_updated"),prop:"ts",fn:function(a){return a?
(new Date(a)).toString():"?"}}];a[b].forEach(function(g){var k=d+b;f.forEach(function(b){var d=h("tr","external_desc",a.uuid,b.prop,"tr"+k),f=h("td","external_desc",a.uuid,b.prop,"td1"+k),e=h("td","",a.uuid,b.prop,"td2"+k);f.textContent=b.label;e.textContent=(b.fn?b.fn:function(a){return a})(g[b.prop]);d.appendChild(f);d.appendChild(e);c.appendChild(d)});var r=h("tr","external_desc_buttons",a.uuid,g.url,"tr"+k),p=h("td","",a.uuid,"buttons","td"+k);r.appendChild(p);c.appendChild(r);if(g.ts){var r=
q("div",a.name,a.uuid,"delete_external"+k),y=n.createButton(a.uuid,"delete_external"+s.createUniqueId(g.url)+k,e.getMessage("Delete"),function(){Ta(a.uuid,g.url);y.parentNode&&y.parentNode.removeChild(y)});r.appendChild(y);p.appendChild(r)}d++});if(!d){var g=h("tr","script_desc",a.uuid,d,"tr"),k=h("td","script_desc",a.uuid,d,"td1");k.textContent=e.getMessage("No_entry_found");g.appendChild(k);c.appendChild(g)}return c},Ra=function(a,b){var c=q("div","",a.uuid,"script_external_h");c.textContent=e.getMessage("Externals");
var d=q("div","",a.uuid,"script_externals_c"),f=h("div","section",a.name,a.uuid,"ta_requires"),g=h("div","section_head",a.name,a.uuid,"head_ta_requires"),k=h("div","section_content",a.name,a.uuid,"content_ta_requires");g.textContent=e.getMessage("Requires");f.appendChild(g);f.appendChild(k);k.appendChild(Ca(a,"requires"));var g=h("div","section",a.name,a.uuid,"ta_resources"),k=h("div","section_head",a.name,a.uuid,"head_ta_resources"),l=h("div","section_content",a.name,a.uuid,"content_ta_resources");
k.textContent=e.getMessage("Resources");g.appendChild(k);g.appendChild(l);l.appendChild(Ca(a,"resources"));k=q("div","",a.uuid,"tab_content_settings");k.appendChild(f);k.appendChild(g);d.appendChild(k);b.appendTab("script_externals_tab"+a.uuid,c,d);return{}},Pa=function(a,b,c){var d=h("tr","editor_container p100100",a.name,a.uuid,"container");if(!a.nnew&&H(a.uuid,"lastI"))return[];a.nnew&&(a.code=a.code.replace("<$URL$>",L.url||"http://*/*"));var f=q("div",a.name,a.uuid,"script_editor_h"),g=f.inserted;
f.textContent=e.getMessage("Editor");var k=q("div",a.name,a.uuid,"script_editor_c"),l=h("tr","editormenubar",a.name,a.uuid,"container_menu"),m=h("table","editor_container_o p100100 noborder",a.name,a.uuid,"container_o");m.appendChild(l);m.appendChild(d);k.appendChild(m);var r=function(b){H(a.uuid,"saveEm")},p=function(a,b){c&&c(b)},m=n.createImageButton(a.uuid,"save_to_disk",e.getMessage("Save_to_disk"),chrome.extension.getURL("/layout/default/images/harddrive2.png"),function(b){b=d.editor&&w.editor_enabled?
d.editor.mirror.getValue():t.value;v.wait();M.plain.download(a.name,b).always(function(){v.hide()})}),y=n.createImageButton(a.uuid,"save",e.getMessage("Save"),chrome.extension.getURL("/layout/default/images/filesave.png"),r),z=n.createImageButton(a.uuid,"cancel",e.getMessage("Editor_reset"),chrome.extension.getURL("/layout/default/images/editor_cancel.png"),function(){confirm(e.getMessage("Really_reset_all_changes_"))&&(d.editor&&w.editor_enabled?d.editor.mirror.setValue(a.code):t.textContent=a.code)}),
F=n.createImageButton(a.uuid,"reset",e.getMessage("Full_reset"),chrome.extension.getURL("/layout/default/images/script_cancel.png"),function(){ta(a.uuid,null,{old_url:x.input?x.input.oldvalue:"",new_url:x.input?x.input.value:"",clean:!0,reload:!0}).done(function(a){a.cleaned&&p(null,!0)});u[a.uuid].fullReset()}),A=n.createImageButton(a.uuid,"close_script",e.getMessage("Close"),chrome.extension.getURL("/layout/default/images/exit.png"),p),I=n.createImageButton(a.uuid,"lint_script",e.getMessage("Run_syntax_check"),
chrome.extension.getURL("/layout/default/images/check.png"),function(){window.setTimeout(function(){d.editor&&w.editor_enabled&&(v.wait(),window.setTimeout(function(){ua.run(d.editor).always(v.hide)},1))},1)}),x=n.createInput(e.getMessage("Update_URL_"),{id:"file_url",uuid:a.uuid,name:a.name,value:a.file_url});x.input.setAttribute("class","updateurl_input");x.elem.setAttribute("class","updateurl");var t=h("textarea","editorta",a.name,a.uuid);t.setAttribute("wrap","off");var B=h("td","editor_outer",
a.name,a.uuid,"edit"),C=h("div","editor_100 editor_border",a.name,a.uuid,"edit"),D=h("div","editormenu",a.name,a.uuid,"editormenu");B.appendChild(C);l.appendChild(D);l.appendChild(x.elem);d.inserted||(C.appendChild(t),d.appendChild(B));a.system||(u[a.uuid].saveEm=function(){var b=!0;w.showFixedSrc&&!a.user_agent&&(b=confirm(e.getMessage("Do_you_really_want_to_store_fixed_code_",e.getMessage("Show_fixed_source"))));var c=d.editor&&w.editor_enabled?d.editor.mirror.getValue():t.value;b&&ta(a.uuid,c,
{old_url:x.input?x.input.oldvalue:"",new_url:x.input?x.input.value:"",clean:!1,new_script:a.nnew,reload:!0,lastModified:u[a.uuid].saveEm_lastModified}).done(function(b){b.installed?a.nnew||b.renamed?p(null,!0):(d.editor.changed=!1,b.lastModified&&(a.lastModified=b.lastModified)):b.aborted||(b.messages&&b.messages.errors&&b.messages.errors.length?s.alert(b.messages.errors.join("\n")):s.alert(e.getMessage("Unable_to_parse_this_")))});return b},D.appendChild(m),D.appendChild(y),D.appendChild(z));a.nnew||
D.appendChild(F);D.appendChild(A);!a.system&&w.editor_enabled&&D.appendChild(I);b.appendTab("script_editor_tab"+a.uuid,f,k).select();if(g)return Q["editor"+a.uuid];var E=function(){var b=!1;w.editor_enabled?d.editor&&(b|=d.editor.changed&&d.editor.mirror.historySize().undo):b=t.value!=a.code;return b},J=function(){w.editor_autoSave&&E()&&H(a.uuid,"saveEm")};b={afterSelect:function(){d.editor&&d.editor.refresh()},onShow:function(){(function(){if(a.referrer&&void 0===a.code){var b=O();aa({referrer:a.referrer,
uuid:a.uuid},function(d){a.code=d.items[0];b.resolve()});return b.promise()}return Fa()})().done(function(){var b=k.getElementsByTagName("textarea");u[a.uuid].lastI=function(){return a};if(b.length&&!d.editor){var b=b[0],c=function(){d.editor&&(d.editor.changed=!0)};if(w.editor_enabled){var f=b.parentNode,g={search:e.getMessage("Search"),replace:e.getMessage("Replace"),jump:e.getMessage("Jump_to_line"),macro:e.getMessage("Insert_constructor"),reindentall:e.getMessage("Auto_Indent_all")};f.removeChild(b);
d.editor=new MirrorFrame(f,{value:a.code,indentUnit:Number(w.editor_indentUnit),indentWithTabs:"tabs"==w.editor_indentWithTabs,smartIndent:"classic"!=w.editor_tabMode,enterMode:w.editor_enterMode,electricChars:"true"==w.editor_electricChars.toString(),lineNumbers:!0,extraKeys:{Enter:"newlineAndIndentContinueComment"},keyMap:w.editor_keyMap,gutters:["gutter","CodeMirror-linenumbers"],matchBrackets:!0},{save:r,close:p,find:function(a){d.editor.searchText=d.editor.search()},findNext:function(a){d.editor.searchText=
d.editor.search(d.editor.searchText)},findPrev:function(a){d.editor.searchText=d.editor.search(d.editor.searchText,!0)}},{change:c,blur:J},g)}else b.value=a.code}})},onClose:function(b){var c=function(){d.editor=null;delete u[a.uuid].lastI};if(!b&&E())return(b=confirm(e.getMessage("There_are_unsaved_changed_")))&&c(),!b;c();return!1}};return Q["editor"+a.uuid]=b},Ja=function(a,b,c){u[a.uuid]||(u[a.uuid]={});var d,f,g=a.icon&&!a.nativeScript,k=["script_name"];a.nativeScript||k.push("clickable");a.blacklisted&&
k.push("crossedout");var l=h("span",k.join(" "),"",a.uuid,"sname"),m=h("img","nameNicon16 icon16","",a.uuid,"sname_img"),r=h("span",g?"nameNname16":"","",a.uuid,"sname_name"),p=sa(a),k=e.getTranslation(a,"name");r.textContent=35<k.length?k.substr(0,35)+"...":k;k=q("span","",a.uuid,"sversion");k.textContent=a.version?a.version:"";g&&(m.src=a.icon,l.appendChild(m));var g=[],y=function(){d&&(d.remove(),d=null);delete Q["tab"+a.uuid];delete Q["editor"+a.uuid]},z=function(){window.setTimeout(function(){for(var d in J){var f=
J[d].script;if(f.uuid==a.uuid){ba(b,[f],null,c);break}}ma()},1)},v=function(b){a.uuid&&s.getUrlArgs(!0).open==a.uuid&&(window.location.hash="");f&&f.onClose&&f.onClose(b)||(y(),l.parentNode&&l.parentNode.removeChild(l),b||z())},B=function(){f&&f.afterSelect&&f.afterSelect()},I=function(g,k){if(!d){var l=null;a.nnew?(l=h("div","head_icon","",a.uuid,"details_h"),l.appendChild(n.createImage(a.imageURL,"",a.uuid,"new_script_head"))):l=h("div","","",a.uuid,"details_h");var m=q("div","",a.uuid,"details_c");
d=c.insertTab(null,"details_"+a.uuid,l,m,B,a.nnew?null:v);a.nnew||d.setHeading(e.getMessage("Edit")+" - "+(25<a.name.length?a.name.substr(0,25)+"...":a.name));f=Sa(d,a,b,m,v)}if(f&&f.onShow)f.onShow();d.show();g&&1==g.button||k||d.select();r.setAttribute("open","true");!a.nnew&&a.uuid&&(window.location.hash="open="+a.uuid)};"true"==r.getAttribute("open")&&I(null,!0);var m=function(a,b){var d=a.getTime(),c=b.getTime(),f=Math.abs(d-c),d=Math.round(f/6E4),c=Math.round(f/36E5),f=Math.round(f/864E5);return 60>=
d?d+" min":48>=c?c+" h":f+" d"},x=q("span","",a.uuid,"last_updated"),t="";if(a.nativeScript||a.nnew||a.system)t="";else if(r.inserted||(x.addEventListener("click",function(){H(a.uuid,"scriptUpdate")}),x.setAttribute("class","clickable"),x.title=e.getMessage("Check_for_Updates")),u[a.uuid].scriptUpdate=function(){var b=x.textContent;x.textContent="";x.appendChild(n.createImage("/layout/default/images/download.gif","down",a.uuid));Ua(a.uuid,function(d){x.textContent=b;d?(x.style.color="green",x.title=
e.getMessage("There_is_an_update_for_0name0_avaiable_",a.name),y(),l.parentNode&&l.parentNode.removeChild(l),Da()):(x.style.color="red",x.title=e.getMessage("No_update_found__sry_"))})},a.lastUpdated)try{t=m(new Date,new Date(a.lastUpdated))}catch(K){console.log("o: error calculating time "+K.message)}else t="?";x.textContent=t;var C=q("div","",a.uuid,"imported"),D="";A.push(function(){w.sync_enabled&&(D=a.nativeScript||a.nnew||a.system?"":a.sync&&a.sync.imported?!0===a.sync.imported||a.sync.imported==
fa.types.ePASTEBIN?'<img src="http://pastebin.com/favicon.ico" class="icon16" title="pastebin.com"/>':a.sync.imported==fa.types.eCHROMESYNC?'<img src="http://www.google.com/images/icons/product/chrome-16.png" class="icon16" title="Google Sync"/>':a.sync.imported==fa.types.eGOOGLE_DRIVE?'<img src="http://www.google.com/images/icons/product/drive-16.png" class="icon16" title="Google Drive"/>':'<img src="/layout/default/images/update.png" class="icon16" />':"",C.innerHTML=D,C=null)});m=q("span","",a.uuid,
"hp");if(a.origin){t=q("a","",a.uuid,"hp");t.setAttribute("href",a.origin.url);t.setAttribute("target","_blank");var E=n.createImage(N.origin(a.origin.token),"",a.uuid,a.origin.token,"");t.appendChild(E);m.appendChild(t)}p&&(t=q("a","",a.uuid,"hp"),t.setAttribute("href",p),t.setAttribute("target","_blank"),p=n.createImage(chrome.extension.getURL("/layout/default/images/home.png"),"",a.uuid,"hp",""),t.appendChild(p),m.appendChild(t));u[a.uuid].saveEm_lastModified=a.lastModified;u[a.uuid].fullReset=
function(){b.parentNode.removeChild(b)};u[a.uuid].reportAnIssue=function(b){Va(a.uuid,b)};u[a.uuid].deleteScript=function(d,c){if(a.nativeScript){var f=c||confirm(e.getMessage("Really_delete_0name0__",a.name));!0==f&&(va(a.uuid,"installed","false"),b.parentNode.removeChild(b))}else f=c||confirm(e.getMessage("Really_delete_0name0__",a.name)),!0==f&&(ta(a.uuid,null,{reload:!c}),b.parentNode.removeChild(b))};p=[];if(a.nativeScript){u[a.uuid].importNativeScript=function(d,c){!0==(c||confirm(e.getMessage("Really_import_0name0__",
a.name)))&&(va(a.uuid,"imported","true"),b.parentNode.removeChild(b))};var G=n.createImage(N.get("import"),"",a.uuid,"import",e.getMessage("Import"),function(){H(a.uuid,"importNativeScript")});n.addClass(G,"hidden");p.push(G);A.push(function(){w.native_import&&n.toggleClass(G,"hidden")})}a.nnew||a.system||(t=n.createImage(N.get("delete"),"",a.uuid,"delete",e.getMessage("Delete"),function(){H(a.uuid,"deleteScript")}),p.push(t));a.nnew||a.system||!a.origin||(t=n.createImage(N.get("flag"),"",a.uuid,
"issue",e.getMessage("Report_an_issue_to_the_script_hoster_"),function(){H(a.uuid,"reportAnIssue","hoster")}),p.push(t));a.nnew||a.system||!a.supportURL||(t=n.createImage(N.get("bug"),"",a.uuid,"bug",e.getMessage("Report_a_bug"),function(){H(a.uuid,"reportAnIssue","author")}),p.push(t));l.inserted||a.nativeScript||l.addEventListener("click",I);l.appendChild(r);t=[a.name];a.description&&t.push(e.getTranslation(a,"description"));a.blacklisted&&(t=[e.getMessage("This_script_is_blacklisted_")]);l.title=
t.join("\n\n").replace(/\"/,"");g.push(a.nnew||a.system?null:{element:Wa(a),style:"script_sel"});g.push(function(){var b=a.blacklisted?"enabler_warning":a.enabled?"enabler_enabled":"enabler_disabled",d=a.blacklisted?e.getMessage("This_script_is_blacklisted_"):a.enabled?e.getMessage("Enabled"):e.getMessage("Disabled"),c=a.position,b=n.createEnabler(b,a.uuid,"enabled","enabled",d,function(){H(a.uuid,a.nativeScript?"switchNativeEnabled":"switchEnabled")},a.nativeScript?"":c);u[a.uuid].switchEnabled=
function(b,d,c){void 0===d&&(d=!a.enabled);T(a.uuid,{enabled:d},c)};u[a.uuid].switchNativeEnabled=function(b,d,c){void 0===d&&(d=!a.enabled);va(a.uuid,"enabled",d,c)};return b}());g.push(l);g.push(k);g.push(Xa(a));g.push(C);g.push(Ya(a));g.push(Za(a));g.push(m);g.push(x);g.push($a(a));g.push(function(a,b){var d=q("span","",a.uuid,"wrap");b&&("Array"===s.toType(b)?s.each(b,function(a,b){d.appendChild(a)}):d.appendChild(b));return d}(a,p));for(k=g.length;10>k;k++)g.push(null);!W.scripts&&L.open&&a.uuid===
L.open?A.push(I):a.nnew&&A.push(function(){I(null,!0)});return g},Xa=function(a){var b=q("span","",a.uuid,"pos_type",!0);if(a.nnew)return b;a.user_agent?(a=n.createImage("images/user_agent.png","",a.uuid,"user_agent",e.getMessage("This_only_changes_the_user_agent_string")),b.appendChild(a)):a.nativeScript?(a=n.createImage(a.icon,"",a.uuid,"chrome_ext",e.getMessage("This_is_a_chrome_extension")),b.appendChild(a)):a.userscript&&(a=n.createImage("images/txt.png","",a.uuid,"user_agent",e.getMessage("This_is_a_userscript")),
b.appendChild(a));return b},Za=function(a){var b=q("span","",a.uuid,"pos_features",!0);if(a.nnew)return b;if(a.system){var c=n.createImage(chrome.extension.getURL("/layout/default/images/lock.png"),"",a.uuid,"lock",e.getMessage("This_is_a_system_script"));b.appendChild(c)}if(a.awareOfChrome||a.nativeScript)c=n.createImage("http://www.google.com/images/icons/product/chrome-16.png","",a.uuid,"chrome_mode",e.getMessage("This_script_runs_in_Chrome_mode")),b.appendChild(c);if(a.nativeScript)return b;a.requires.length&&
(c=n.createImage("/layout/default/images/script_download.png","",a.uuid,"requires",s.map(s.select(a.requires,function(a){return a&&a.url}),function(a){return a.url}).join("\n")),b.appendChild(c));a.resources.length&&(c=n.createImage("/layout/default/images/resources.png","",a.uuid,"resources",s.map(s.select(a.resources,function(a){return a&&a.url}),function(a){return a.url}).join("\n")),b.appendChild(c));var c=!1,d={includes:!0,matches:!0},f;for(f in d)if(a[f]){for(d=0;d<a[f].length;d++)if(a[f][d]&&
(-1!=a[f][d].search("https")||-1!=a[f][d].search(/^\*:\/\//))){c=n.createImage(chrome.extension.getURL("/layout/default/images/halfencrypted.png"),"",a.uuid,"encrypt",e.getMessage("This_script_has_access_to_https_pages"));b.appendChild(c);c=!0;break}if(c)break}if(a.user_agent)return b;if(a.grant&&a.grant.length){var g={};a.grant.forEach(function(a){g[a]=!0});g.GM_xmlhttpRequest&&(c=n.createImage(chrome.extension.getURL("/layout/default/images/web.png"),"",a.uuid,"web",e.getMessage("This_script_has_full_web_access")),
b.appendChild(c));g.GM_setValue&&(c=n.createImage(chrome.extension.getURL("/layout/default/images/db.png"),"",a.uuid,"db",e.getMessage("This_script_stores_data")),b.appendChild(c));g.unsafeWindow&&(c=n.createImage(chrome.extension.getURL("/layout/default/images/windowlist.png"),"",a.uuid,"unsafeWindow",e.getMessage("This_script_has_access_to_webpage_scripts")),b.appendChild(c))}else c=n.createImage(chrome.extension.getURL("/layout/default/images/critical.png"),"grant",a.uuid,"crit",e.getMessage("This_script_has_no_grant_header_set_")),
b.appendChild(c);for(f in a.options)if(-1!=f.search("compat_")&&a.options[f]){c=n.createImage(chrome.extension.getURL("/layout/default/images/critical.png"),"compat",a.uuid,"crit",e.getMessage("One_or_more_compatibility_options_are_set"));b.appendChild(c);break}return b},ab=function(){var a=null,b=null,c=null,d=0,f=0,g=function(b){var d=c.x+b.pageX;a.style.top=c.y+b.pageY+"px";a.style.left=d+"px"},e=function(c){if(a){var e=null;for(g(c);e!=f;){var e=f,k=b.previousSibling,m=b.nextSibling,h=b.parentNode,
n=l(b);c.pageY>n.y+d&&m?(h.removeChild(m),h.insertBefore(m,b),f++):c.pageY<n.y&&1<f&&(h.removeChild(k),m?h.insertBefore(k,m):h.appendChild(k),f--)}}},l=function(a){for(var b=a.offsetLeft,d=a.offsetTop;a=a.offsetParent;)b+=a.offsetLeft,d+=a.offsetTop;return{x:b,y:d}},m={start:function(){document.addEventListener("mousemove",e);document.addEventListener("scroll",e)},stop:function(){document.removeEventListener("mousemove",e);document.removeEventListener("scroll",e)},handleEvent:function(e,k){if(a){a.style.position=
"static";var h={};h[a.key]=f;T(a.uuid,h);a=b=c=null;m.stop()}else m.start(),a=this,b=a.parentNode.parentNode.parentNode,d=b.offsetHeight,c=l(b.parentNode.parentNode),c.x=-c.x-a.offsetWidth/2,c.y=-c.y-a.offsetHeight/2,a.style.position="absolute",g(e),f=k}};return m}(),$a=function(a){var b=h("span","sorting","",a.uuid,"pos_images",!0);if(a.nnew||a.nativeScript)return b;"pos"==P()&&"up"==S()||b.setAttribute("style","display: none;");if(1<a.position||a.position<a.positionof){var c=h("span","clickable movable",
"position",a.uuid,!0);c.innerHTML="&#9776;";c.title=e.getMessage("Click_here_to_move_this_script");c.uuid=a.uuid;c.key="position";c.addEventListener("click",function(b){ab.handleEvent.apply(this,[b,a.position])});b.appendChild(c)}return b},Ya=function(a){var b=q("span","",a.uuid,"site_images"),c=null;b.inserted&&(c=b,c.setAttribute("id",c.id+"foo"),b=q("span","",a.uuid,"site_images"));qa.topIcons(a,7).forEach(function(a){b.appendChild(a,!0)});c&&c.parentNode.removeChild(c);return b},Wa=function(a){var b=
q("input","",a.uuid,"sel");b.type="checkbox";b.s_id=a.uuid;b.name="scriptselectors";b.s_type=a.nativeScript?"n":"s";b.inserted||b.addEventListener("click",function(){u.multiselect.single_click()});return b},Ga=function(a){var b=h("input","multiselectcb","sms","all",null),c=h("input","multiselectcb","sms2","all",null);b.inserted||(b.type="checkbox",b.addEventListener("click",u.multiselect.un_selectAll),c.type="checkbox",c.addEventListener("click",u.multiselect.un_selectAll));var d=0,f=[{name:e.getMessage("__Please_choose__"),
value:0},{name:e.getMessage("Enable"),value:1},{name:e.getMessage("Disable"),value:2},{name:e.getMessage("Toggle_Enable"),value:7},{name:e.getMessage("Export"),value:3},{name:e.getMessage("Trigger_Update"),value:5},{name:e.getMessage("Remove"),value:6}],f=n.createDropDown(e.getMessage("Apply_this_action_to_the_selected_scripts"),{value:0,uuid:"sms-select",name:"select"},f,function(){0==this.value?g.setAttribute("disabled","true"):g.removeAttribute("disabled");d=this.value});f.elem.setAttribute("class",
"float");f.elem.setAttribute("style","display: inline-block;");var g=n.createButton("MultiSelectButton","button",e.getMessage("Start"),function(){if(0==d)console.log("option: ?!?!");else if(6!=d||confirm(e.getMessage("Really_delete_the_selected_items_"))){for(var a=document.getElementsByName("scriptselectors"),b=[],c=0;c<a.length;c++)b.push(a[c]);for(var a={},f,g=!1,h=100,c=0;c<b.length;c++)if(b[c].checked)if(1==d||2==d||7==d){f="n"==b[c].s_type?"switchNativeEnabled":"switchEnabled";var n;if(7==d){var q=
J[b[c].s_id]?J[b[c].s_id].script:null;q&&(n=!q.enabled)}else n=1==d;void 0!==n&&(H(b[c].s_id,f,null,n,!1),g=!0)}else 3==d?a[b[c].s_id]=!0:5==d?(f="scriptUpdate",H(b[c].s_id,f)):6==d&&(f="deleteScript",H(b[c].s_id,f,null,!0),g=!0,h=1500);3==d&&(v.wait(),ca(a,{storage:R}).then(function(a){v.wait();return M.zip.download(a).progress(function(a){v.wait(Math.floor(a.item/a.of*100)+"%")})}).always(function(){v.hide()}));g&&(v.wait(e.getMessage("Please_wait___")),window.setTimeout(function(){Da()},h))}});
g.setAttribute("class","action_button");g.setAttribute("disabled","true");a=q("div",a.name,a.id,"actions");a.setAttribute("style","display: inline-block;");a.appendChild(f.elem);a.appendChild(g);return{selAllm:c,selAll:b,actionBox:a}};(function(){var a=0;u.multiselect={};u.multiselect.toggleRow=function(a){var c=$(document.getElementsByName("multiselectcol")||[]);a?c.show():c.hide()};u.multiselect.single_click=function(){for(var b=0,c=document.getElementsByName("scriptselectors"),d=!0,f=!1,e=!1,k=
!0,h=!1,m=!1,n=0,p=0;p<c.length;p++)"n"==c[p].s_type?(e=!0,d=d&&c[p].checked,f=f||c[p].checked):"s"==c[p].s_type&&(m=!0,k=k&&c[p].checked,h=h||c[p].checked),c[p].checked&&n++;!e||!d||m&&!k&&h||(b+=1);!m||!k||e&&!d&&f||(b+=2);b!=a&&(a=b,$(".multiselectcb").prop("checked",0!=b?"checked":""));u.multiselect.toggleRow(n);u.multiselect.checkScroll&&u.multiselect.checkScroll()};u.multiselect.un_selectAll=function(){3<++a&&(a=0);for(var b=!1,c=0,d=document.getElementsByName("scriptselectors"),f=0;f<d.length;f++)0!=
f||1!=a&&3!=a||"s"!=d[f].s_type||3<++a&&(a=0),b|="s"==d[f].s_type,d[f].checked=3==a||1==a&&"n"==d[f].s_type||2==a&&"s"==d[f].s_type,d[f].checked&&c++;1<a&&!b&&(a=0);$(".multiselectcb").prop("checked",0!=a?"checked":"");u.multiselect.toggleRow(c)}})();var ua={cleanGutters:function(a,b){a.clearGutter("gutter")},setGutters:function(a,b){for(var c in b)if(b.hasOwnProperty(c)){var d=b[c],f=0,g=null,h=[];d.marks=[];for(var l=0;l<d.length;l++){var m="",n=d[l];n.stop?(g="no",f=3):n.warn?(1>f&&(g="critical",
f=1),m=e.getMessage("Warning")+": "):n.info?(0==f&&(g="info"),m=e.getMessage("Info")+": "):2>f&&(g="error",f=2,m=e.getMessage("Error")+": ");h.push((1<d.length?m:"")+n.text.replace(/\"/g,'\\"'));n.stop||d.marks.push(a.markText({line:n.line-1,ch:n.character-1},{line:n.line-1,ch:n.character-1+n.evle},{className:"CodeMirror-highlight-"+g}))}d=$("<span>").append($("<span>").attr("class","editor_gutter").attr("title",h.join("\n\n")).append($("<span>").attr("width","15px").append($("<img>").attr("class",
"editor_gutter_img").attr("src","/layout/default/images/"+g+".png"))))[0];a.setGutterMarker(Number(c)-1,"gutter",d)}return b},run:function(a){a.oldGutters&&ua.cleanGutters(a.mirror,a.oldGutters);return function(){var a=O();Registry.require("hinter",function(){a.resolve(Registry.get("hinter"))});return a.promise()}().then(function(b){return b.hint(a.mirror.getValue(),{maxerr:1E4},{})}).done(function(b){if(b){var c={};s.each(b,function(a){if(a&&1<a.line){var b=a.line,e=a.character,h=0,l=a.reason.toLowerCase(),
m=-1!=l.search("mixed spaces and tabs"),n=0;try{var p=!!a.evidence&&!m;if(p)for(var q=0,s=0;q<e&&s<e;q++,s++)9==a.evidence.charCodeAt(q)&&(s+=w.editor_indentUnit-1,h+=1);e-=h*(w.editor_indentUnit-1);if(p||m)var u=a.evidence.length>e?a.evidence.substr(e-1):"",v=m?u.match(/([ \t])*/):u.match(/([a-zA-Z0-9_])*/),n=v&&v.length?v[0].length:0}catch(A){console.log("jshint: error parsing source "+A.message)}h=n||1;a={line:b,stop:0==l.search("stopping"),info:m||-1!=l.search("forgotten")||-1!=l.search("not necessary")||
-1!=l.search("unnecessary")||-1!=l.search("better written")||-1!=l.search("bad line breaking")||-1!=l.search("semicolon"),warn:"(error)"!=a.id||-1!=l.search("unreachable")||-1!=l.search("to compare with")||-1!=l.search("can be")||-1!=l.search("is preferable")||-1!=l.search("already defined"),character:e,evle:h,text:a.code+": "+a.reason.replace(/.$/,"")};a.stop&&b++;c[b]||(c[b]=[]);c[b].push(a)}});a.oldGutters=ua.setGutters(a.mirror,c)}})}},V=null,K=function(){V&&(window.clearTimeout(V),V=null)},G=
function(){V||(V=window.setTimeout(function(){V=null;v.wait(e.getMessage("Please_wait___"))},250))},Y=null,da=null,B=function(a){null!=Y?(window.clearTimeout(Y),Y=null,B(a?a:da.items)):(da={items:a},Y=window.setTimeout(function(){Y=null;J={};var a=da.items,c=ea.create("_main",h("div","tv_container","opt","tv_container"));ba(null,a,null,c);v.hide();ma();da=null},50))},pa=function(a,b){try{var c=function(c){chrome.tabs.sendMessage(c.id,{method:"loadUrl",url:a,newtab:b},function(a){})};b?sendMessage({method:"newTab",
url:a},function(a){}):chrome.tabs.getSelected(null,c)}catch(d){console.log("lU: "+d.message)}},Ma=function(a,b){var c=O();try{sendMessage({method:"exportToJson",ids:a,options:b},function(a){K();v.hide();a.json?c.resolve(a.json):c.reject()}),G()}catch(d){console.log("eJ: "+d.message),c.reject({})}return c.promise()},ra=function(a,b){var c=O();try{sendMessage({method:"importFromJson",json:a,reload:b.reload},function(a){K();v.hide();a.items&&B(a.items);b.reload&&v.hide();a.err?c.reject(a):c.resolve(a)}),
G()}catch(d){console.log("sS: "+d.message),c.reject({err:d.message})}return c.promise()},ta=function(a,b,c){var d=O();void 0===c.reload&&(c.reload=!0);try{sendMessage({method:"saveScript",uuid:a,code:b,clean:c.clean,force:c.force,new_script:c.new_script,force_url:c.new_url&&c.new_url!=c.old_url?c.new_url:"",lastModified:c.lastModified,reload:c.reload},function(a){K();a.items&&B(a.items);!b&&c.reload&&v.hide();d.resolve(a)}),G()}catch(e){console.log("sS: "+e.message),d.reject({err:e.message})}return d.promise()},
na=function(a,b,c){try{sendMessage({method:"setOption",name:a,value:b},function(a){K();w=a.options||w;c||B(a.items)}),G()}catch(d){console.log("sO: "+d.message)}},Ia=function(a,b,c,d){try{sendMessage({method:"buttonPress",name:a},function(a){K();d?window.location.reload():c?v.hide():B(a.items)}),G()}catch(e){console.log("sO: "+e.message)}},aa=function(a,b){sendMessage({method:"loadTree",complete:a.complete,uuid:a.uuid,referrer:a.referrer},function(a){K();w=a.options||w;a.i18n&&e.setLocale(a.i18n);
b(a)});G()},Da=function(){aa({referrer:"options.scripts"},function(a){B(a.items)})},T=function(a,b,c){void 0==c&&(c=!0);try{a={method:"modifyScriptOptions",uuid:a,reload:c};for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);sendMessage(a,function(a){K();w=a.options||w;a.i18n&&e.setLocale(a.i18n);a.items&&B(a.items)});G()}catch(f){console.log("mSo: "+f.message)}},va=function(a,b,c,d){void 0===d&&(d=!0);try{sendMessage({method:"modifyNativeScript",nid:a,actionid:b,value:c,reload:d},function(a){K();a.items&&
B(a.items)}),G()}catch(e){console.log("mSo: "+e.message)}},Ta=function(a,b){try{sendMessage({method:"buttonPress",name:"externals_delete",scriptuid:a,url:b},function(a){K();a.items&&B(a.items)}),G()}catch(c){console.log("dEx: "+c.message)}},Ua=function(a,b){try{sendMessage({method:"buttonPress",name:"run_script_updates",scriptuid:a},function(a){b&&b(a.updatable)})}catch(c){console.log("rSu: "+c.message)}},Va=function(a,b,c){try{sendMessage({method:"reportAnIssue",uuid:a,to:b},function(a){c&&c()})}catch(d){console.log("rRi: "+
d.message)}};chrome.extension.onMessage.addListener(function(a,b,c){if("updateOptions"==a.method)w=a.options||w,B(a.items),c({});else if("confirm"==a.method)s.confirm(a.msg,function(a){c({confirm:a})});else if("showMsg"==a.method)s.alert(a.msg),c({});else return!1;return!0});(function(){aa({referrer:"options"},function(a){Oa();B(a.items)})})()})});
